!function(){var t={},n=function(n){for(var e=t[n],o=e.deps,i=e.defn,u=o.length,a=new Array(u),c=0;c<u;++c)a[c]=r(o[c]);var l=i.apply(null,a);if(void 0===l)throw"module ["+n+"] returned undefined";e.instance=l},e=function(n,e,r){if("string"!=typeof n)throw"module id must be a string";if(void 0===e)throw"no dependencies for "+n;if(void 0===r)throw"no definition function for "+n;t[n]={deps:e,defn:r,instance:void 0}},r=function(e){var r=t[e];if(void 0===r)throw"module ["+e+"] was undefined";return void 0===r.instance&&n(e),r.instance},o=function(t,n){for(var e=t.length,o=new Array(e),i=0;i<e;++i)o[i]=r(t[i]);n.apply(null,o)};({}).bolt={module:{api:{define:e,require:o,demand:r}}};var i=e,u=function(t,n){i(t,[],function(){return n})};i("1",[],function(){var t=function(n){var e=n,r=function(){return e};return{get:r,set:function(t){e=t},clone:function(){return t(r())}}};return t}),u("7",tinymce.util.Tools.resolve),i("2",["7"],function(t){return t("tinymce.PluginManager")}),i("8",["7"],function(t){return t("tinymce.util.Tools")}),i("13",[],function(){function t(t,n){return o(document.createElement("canvas"),t,n)}function n(n){var r;return e(r=t(n.width,n.height)).drawImage(n,0,0),r}function e(t){return t.getContext("2d")}function r(t){var n=null;try{n=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(t){}return n||(n=null),n}function o(t,n,e){return t.width=n,t.height=e,t}return{create:t,clone:n,resize:o,get2dContext:e,get3dContext:r}}),i("14",[],function(){function t(t){return t.naturalWidth||t.width}function n(t){return t.naturalHeight||t.height}return{getWidth:t,getHeight:n}}),i("15",[],function(){function t(t,n){return function(){t.apply(n,arguments)}}function n(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],a(n,t(r,this),t(o,this))}function e(t){var n=this;return null===this._state?void this._deferreds.push(t):void c(function(){var e=n._state?t.onFulfilled:t.onRejected;if(null!==e){var r;try{r=e(n._value)}catch(n){return void t.reject(n)}t.resolve(r)}else(n._state?t.resolve:t.reject)(n._value)})}function r(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var e=n.then;if("function"==typeof e)return void a(t(e,n),t(r,this),t(o,this))}this._state=!0,this._value=n,i.call(this)}catch(t){o.call(this,t)}}function o(t){this._state=!1,this._value=t,i.call(this)}function i(){for(var t=0,n=this._deferreds.length;t<n;t++)e.call(this,this._deferreds[t]);this._deferreds=null}function u(t,n,e,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof n?n:null,this.resolve=e,this.reject=r}function a(t,n,e){var r=!1;try{t(function(t){r||(r=!0,n(t))},function(t){r||(r=!0,e(t))})}catch(t){if(r)return;r=!0,e(t)}}if(window.Promise)return window.Promise;var c=n.immediateFn||"function"==typeof setImmediate&&setImmediate||function(t){setTimeout(t,1)},l=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};return n.prototype["catch"]=function(t){return this.then(null,t)},n.prototype.then=function(t,r){var o=this;return new n(function(n,i){e.call(o,new u(t,r,n,i))})},n.all=function(){var t=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new n(function(n,e){function r(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var a=u.then;if("function"==typeof a)return void a.call(u,function(t){r(i,t)},e)}t[i]=u,0==--o&&n(t)}catch(t){e(t)}}if(0===t.length)return n([]);for(var o=t.length,i=0;i<t.length;i++)r(i,t[i])})},n.resolve=function(t){return t&&"object"==typeof t&&t.constructor===n?t:new n(function(n){n(t)})},n.reject=function(t){return new n(function(n,e){e(t)})},n.race=function(t){return new n(function(n,e){for(var r=0,o=t.length;r<o;r++)t[r].then(n,e)})},n}),u("f",Array),u("g",Error),i("a",["f","g"],function(t,n){var e=function(t){return function(){return t}};return{noop:function(){},noarg:function(t){return function(){return t()}},compose:function(t,n){return function(){return t(n.apply(null,arguments))}},constant:e,identity:function(t){return t},tripleEquals:function(t,n){return t===n},curry:function(n){for(var e=new t(arguments.length-1),r=1;r<arguments.length;r++)e[r-1]=arguments[r];return function(){for(var r=new t(arguments.length),o=0;o<r.length;o++)r[o]=arguments[o];var i=e.concat(r);return n.apply(null,i)}},not:function(t){return function(){return!t.apply(null,arguments)}},die:function(t){return function(){throw new n(t)}},apply:function(t){return t()},call:function(t){t()},never:e(!1),always:e(!0)}}),u("16",Object),i("q",["a","16"],function(t,n){var e,r,o,i,u=t.never,a=t.always,c=function(){return l},l=(i={fold:function(t){return t()},is:u,isSome:u,isNone:a,getOr:o=function(t){return t},getOrThunk:r=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},or:o,orThunk:r,map:c,ap:c,each:function(){},bind:c,flatten:c,exists:u,forall:a,filter:c,equals:e=function(t){return t.isNone()},equals_:e,toArray:function(){return[]},toString:t.constant("none()")},n.freeze&&n.freeze(i),i),f=function(t){var n=function(){return t},e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:a,isNone:u,getOr:n,getOrThunk:n,getOrDie:n,or:e,orThunk:e,map:function(n){return f(n(t))},ap:function(n){return n.fold(c,function(n){return f(n(t))})},each:function(n){n(t)},bind:r,flatten:n,exists:r,forall:r,filter:function(n){return n(t)?o:l},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(u,function(n){return e(t,n)})},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return o};return{some:f,none:c,from:function(t){return null===t||void 0===t?l:f(t)}}}),i("1l",[],function(){return"undefined"!=typeof window?window:Function("return this;")()}),i("1d",["1l"],function(t){var n=function(n,e){for(var r=void 0!==e?e:t,o=0;o<n.length&&void 0!==r&&null!==r;++o)r=r[n[o]];return r},e=function(t,n){return void 0!==t[n]&&null!==t[n]||(t[n]={}),t[n]},r=function(n,r){for(var o=void 0!==r?r:t,i=0;i<n.length;++i)o=e(o,n[i]);return o};return{path:n,resolve:function(t,e){var r=t.split(".");return n(r,e)},forge:r,namespace:function(t,n){var e=t.split(".");return r(e,n)}}}),i("u",["1d"],function(t){var n=function(n,e){return t.resolve(n,e)};return{getOrDie:function(t,e){var r=n(t,e);if(void 0===r)throw t+" not available on this browser";return r}}}),i("17",["u"],function(t){return function(n,e){return new(t.getOrDie("Blob"))(n,e)}}),i("18",["u"],function(t){return function(){return new(t.getOrDie("FileReader"))}}),i("19",["u"],function(t){return function(n){return new(t.getOrDie("Uint8Array"))(n)}}),i("1a",["u"],function(t){return{atob:function(n){return t.getOrDie("atob")(n)},requestAnimationFrame:function(n){t.getOrDie("requestAnimationFrame")(n)}}}),u("x",Math),i("p",["13","14","15","q","17","18","19","1a","f","x"],function(t,n,e,r,o,i,u,a,c,l){function f(t){return new e(function(n){function e(){t.removeEventListener("load",e),n(t)}t.complete?n(t):t.addEventListener("load",e)})}function s(t){return f(t).then(function(t){var n=t.src;return 0===n.indexOf("blob:")?h(n):0===n.indexOf("data:")?g(n):h(n)})}function d(t){return new e(function(n,e){function r(){a(),n(u)}function o(){a(),e("Unable to load data of type "+t.type+": "+i)}var i=URL.createObjectURL(t),u=new Image,a=function(){u.removeEventListener("load",r),u.removeEventListener("error",o)};u.addEventListener("load",r),u.addEventListener("error",o),u.src=i,u.complete&&r()})}function h(t){return new e(function(n){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="blob",e.onload=function(){200==this.status&&n(this.response)},e.send()})}function p(t){var n=t.split(","),e=/data:([^;]+)/.exec(n[0]);if(!e)return r.none();for(var i=e[1],f=n[1],s=1024,d=a.atob(f),h=d.length,p=l.ceil(h/s),g=new c(p),m=0;m<p;++m){for(var v=m*s,b=l.min(v+s,h),y=new c(b-v),w=v,x=0;w<b;++x,++w)y[x]=d[w].charCodeAt(0);g[m]=u(y)}return r.some(o(g,{type:i}))}function g(t){return new e(function(n,e){p(t).fold(function(){e("uri is not base64: "+t)},n)})}function m(t){return 0===t.indexOf("blob:")?h(t):0===t.indexOf("data:")?g(t):null}function v(t,n,r){return n=n||"image/png",HTMLCanvasElement.prototype.toBlob?new e(function(e){t.toBlob(function(t){e(t)},n,r)}):g(t.toDataURL(n,r))}function b(t,n,e){return n=n||"image/png",t.then(function(t){return t.toDataURL(n,e)})}function y(e){return d(e).then(function(e){var r;return I(e),r=t.create(n.getWidth(e),n.getHeight(e)),t.get2dContext(r).drawImage(e,0,0),r})}function w(t){return new e(function(n){var e=new i;e.onloadend=function(){n(e.result)},e.readAsDataURL(t)})}function x(t){return w(t).then(function(t){return t.split(",")[1]})}function I(t){URL.revokeObjectURL(t.src)}return{blobToImage:d,imageToBlob:s,blobToDataUri:w,blobToBase64:x,dataUriToBlobSync:p,canvasToBlob:v,canvasToDataURL:b,blobToCanvas:y,uriToBlob:m}}),i("c",["p","q"],function(t,n){return{blobToImage:function(n){return t.blobToImage(n)},imageToBlob:function(n){return t.imageToBlob(n)},blobToDataUri:function(n){return t.blobToDataUri(n)},blobToBase64:function(n){return t.blobToBase64(n)},dataUriToBlobSync:function(n){return t.dataUriToBlobSync(n)},uriToBlob:function(e){return n.from(t.uriToBlob(e))}}}),i("t",["13","p","15","a"],function(t,n,e,r){function o(o,i,u){function a(){return e.resolve(i)}function c(){return u}function l(){return u.split(",")[1]}function f(t,e){return o.then(function(r){return n.canvasToBlob(r,t,e)})}function s(t,e){return o.then(function(r){return n.canvasToDataURL(r,t,e)})}function d(t,n){return s(t,n).then(function(t){return t.split(",")[1]})}function h(){return o.then(t.clone)}var p=i.type;return{getType:r.constant(p),toBlob:a,toDataURL:c,toBase64:l,toAdjustedBlob:f,toAdjustedDataURL:s,toAdjustedBase64:d,toCanvas:h}}function i(t){return n.blobToDataUri(t).then(function(e){return o(n.blobToCanvas(t),t,e)})}function u(t,r){return n.canvasToBlob(t,r).then(function(n){return o(e.resolve(t),n,t.toDataURL())})}function a(t){return n.imageToBlob(t).then(function(t){return i(t)})}return{fromBlob:i,fromCanvas:u,fromImage:a,fromBlobAndUrlSync:function(t,e){return o(n.blobToCanvas(t),t,e)}}}),i("1b",[],function(){function t(t,n,e){return(t=parseFloat(t))>e?t=e:t<n&&(t=n),t}function n(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function e(t,n){var e,r,o,i,u=[],a=new Array(10);for(e=0;e<5;e++){for(r=0;r<5;r++)u[r]=n[r+5*e];for(r=0;r<5;r++){for(i=0,o=0;o<5;o++)i+=t[r+5*o]*u[o];a[r+5*e]=i}}return a}function r(n,e){return e=t(e,0,1),n.map(function(n,r){return r%6==0?n=1-(1-n)*e:n*=e,t(n,0,1)})}function o(n,r){var o;return r=t(r,-1,1),(r*=100)<0?o=127+r/100*127:o=127*(o=0===(o=r%1)?s[r]:s[Math.floor(r)]*(1-o)+s[Math.floor(r)+1]*o)+127,e(n,[o/127,0,0,0,.5*(127-o),0,o/127,0,0,.5*(127-o),0,0,o/127,0,.5*(127-o),0,0,0,1,0,0,0,0,0,1])}function i(n,r){var o,i,u,a;return e(n,[(i=.3086)*(1-(o=1+((r=t(r,-1,1))>0?3*r:r)))+o,(u=.6094)*(1-o),(a=.082)*(1-o),0,0,i*(1-o),u*(1-o)+o,a*(1-o),0,0,i*(1-o),u*(1-o),a*(1-o)+o,0,0,0,0,0,1,0,0,0,0,0,1])}function u(n,r){var o,i,u,a,c;return r=t(r,-180,180)/180*Math.PI,o=Math.cos(r),i=Math.sin(r),e(n,[(u=.213)+o*(1-u)+i*-u,(a=.715)+o*-a+i*-a,(c=.072)+o*-c+i*(1-c),0,0,u+o*-u+.143*i,a+o*(1-a)+.14*i,c+o*-c+-.283*i,0,0,u+o*-u+i*-(1-u),a+o*-a+i*a,c+o*(1-c)+i*c,0,0,0,0,0,1,0,0,0,0,0,1])}function a(n,r){return e(n,[1,0,0,0,r=t(255*r,-255,255),0,1,0,0,r,0,0,1,0,r,0,0,0,1,0,0,0,0,0,1])}function c(n,r,o,i){return e(n,[r=t(r,0,2),0,0,0,0,0,o=t(o,0,2),0,0,0,0,0,i=t(i,0,2),0,0,0,0,0,1,0,0,0,0,0,1])}function l(n,o){return e(n,r([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0,0,0,0,0,1],o=t(o,0,1)))}function f(n,o){return e(n,r([.33,.34,.33,0,0,.33,.34,.33,0,0,.33,.34,.33,0,0,0,0,0,1,0,0,0,0,0,1],o=t(o,0,1)))}var s=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:n,adjust:r,multiply:e,adjustContrast:o,adjustBrightness:a,adjustSaturation:i,adjustHue:u,adjustColors:c,adjustSepia:l,adjustGrayscale:f}}),i("r",["13","t","1b"],function(t,n,e){function r(t,n){return t.toCanvas().then(function(e){return o(e,t.getType(),n)})}function o(e,r,o){function i(t,n){var e,r,o,i,u,a=t.data,c=n[0],l=n[1],f=n[2],s=n[3],d=n[4],h=n[5],p=n[6],g=n[7],m=n[8],v=n[9],b=n[10],y=n[11],w=n[12],x=n[13],I=n[14],R=n[15],k=n[16],T=n[17],C=n[18],B=n[19];for(u=0;u<a.length;u+=4)e=a[u],r=a[u+1],o=a[u+2],i=a[u+3],a[u]=e*c+r*l+o*f+i*s+d,a[u+1]=e*h+r*p+o*g+i*m+v,a[u+2]=e*b+r*y+o*w+i*x+I,a[u+3]=e*R+r*k+o*T+i*C+B;return t}var u,a=t.get2dContext(e);return u=i(a.getImageData(0,0,e.width,e.height),o),a.putImageData(u,0,0),n.fromCanvas(e,r)}function i(t,n){return t.toCanvas().then(function(e){return u(e,t.getType(),n)})}function u(e,r,o){function i(t,n,e){function r(t,n,e){return t>e?t=e:t<n&&(t=n),t}var o,i,u,a,c,l,f,s,d,h,p,g,m,v,b,y,w;for(u=Math.round(Math.sqrt(e.length)),a=Math.floor(u/2),o=t.data,i=n.data,y=t.width,w=t.height,l=0;l<w;l++)for(c=0;c<y;c++){for(f=s=d=0,p=0;p<u;p++)for(h=0;h<u;h++)g=r(c+h-a,0,y-1),m=r(l+p-a,0,w-1),v=4*(m*y+g),b=e[p*u+h],f+=o[v]*b,s+=o[v+1]*b,d+=o[v+2]*b;i[v=4*(l*y+c)]=r(f,0,255),i[v+1]=r(s,0,255),i[v+2]=r(d,0,255)}return n}var u,a=t.get2dContext(e);return u=i(a.getImageData(0,0,e.width,e.height),u=a.getImageData(0,0,e.width,e.height),o),a.putImageData(u,0,0),n.fromCanvas(e,r)}function a(e){var r=function(r,o,i){function u(t,n){var e,r=t.data;for(e=0;e<r.length;e+=4)r[e]=n[r[e]],r[e+1]=n[r[e+1]],r[e+2]=n[r[e+2]];return t}var a,c,l=t.get2dContext(r),f=new Array(256);for(c=0;c<f.length;c++)f[c]=e(c,i);return a=u(l.getImageData(0,0,r.width,r.height),f),l.putImageData(a,0,0),n.fromCanvas(r,o)};return function(t,n){return t.toCanvas().then(function(e){return r(e,t.getType(),n)})}}function c(t){return function(n,o){return r(n,t(e.identity(),o))}}function l(t){return function(n){return r(n,t)}}function f(t){return function(n){return i(n,t)}}return{invert:l([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:c(e.adjustBrightness),hue:c(e.adjustHue),saturate:c(e.adjustSaturation),contrast:c(e.adjustContrast),grayscale:c(e.adjustGrayscale),sepia:c(e.adjustSepia),colorize:function(t,n,o,i){return r(t,e.adjustColors(e.identity(),n,o,i))},sharpen:f([0,-1,0,-1,5,-1,0,-1,0]),emboss:f([-2,-1,0,-1,1,1,0,1,2]),gamma:a(function(t,n){return 255*Math.pow(t/255,1-n)}),exposure:a(function(t,n){return 255*(1-Math.exp(-t/255*n))}),colorFilter:r,convoluteFilter:i}}),i("1c",["13","14","15"],function(t,n,e){function r(t,e,i){var u=n.getWidth(t),a=n.getHeight(t),c=e/u,l=i/a,f=!1;(c<.5||c>2)&&(c=c<.5?.5:2,f=!0),(l<.5||l>2)&&(l=l<.5?.5:2,f=!0);var s=o(t,c,l);return f?s.then(function(t){return r(t,e,i)}):s}function o(r,o,i){return new e(function(e){var u=n.getWidth(r),a=n.getHeight(r),c=Math.floor(u*o),l=Math.floor(a*i),f=t.create(c,l);t.get2dContext(f).drawImage(r,0,0,u,a,0,0,c,l),e(f)})}return{scale:r}}),i("s",["13","t","1c"],function(t,n,e){function r(t,n){return t.toCanvas().then(function(e){return o(e,t.getType(),n)})}function o(e,r,o){var i=t.create(e.width,e.height),u=t.get2dContext(i),a=0,c=0;return 90!=(o=o<0?360+o:o)&&270!=o||t.resize(i,i.height,i.width),90!=o&&180!=o||(a=i.width),270!=o&&180!=o||(c=i.height),u.translate(a,c),u.rotate(o*Math.PI/180),u.drawImage(e,0,0),n.fromCanvas(i,r)}function i(t,n){return t.toCanvas().then(function(e){return u(e,t.getType(),n)})}function u(e,r,o){var i=t.create(e.width,e.height),u=t.get2dContext(i);return"v"==o?(u.scale(1,-1),u.drawImage(e,0,-i.height)):(u.scale(-1,1),u.drawImage(e,-i.width,0)),n.fromCanvas(i,r)}function a(t,n,e,r,o){return t.toCanvas().then(function(i){return c(i,t.getType(),n,e,r,o)})}function c(e,r,o,i,u,a){var c=t.create(u,a);return t.get2dContext(c).drawImage(e,-o,-i),n.fromCanvas(c,r)}function l(t,r,o){return t.toCanvas().then(function(i){return e.scale(i,r,o).then(function(e){return n.fromCanvas(e,t.getType())})})}return{rotate:r,flip:i,crop:a,resize:l}}),i("d",["r","s"],function(t,n){return{invert:function(n){return t.invert(n)},sharpen:function(n){return t.sharpen(n)},emboss:function(n){return t.emboss(n)},brightness:function(n,e){return t.brightness(n,e)},hue:function(n,e){return t.hue(n,e)},saturate:function(n,e){return t.saturate(n,e)},contrast:function(n,e){return t.contrast(n,e)},grayscale:function(n,e){return t.grayscale(n,e)},sepia:function(n,e){return t.sepia(n,e)},colorize:function(n,e,r,o){return t.colorize(n,e,r,o)},gamma:function(n,e){return t.gamma(n,e)},exposure:function(n,e){return t.exposure(n,e)},flip:function(t,e){return n.flip(t,e)},crop:function(t,e,r,o,i){return n.crop(t,e,r,o,i)},resize:function(t,e,r){return n.resize(t,e,r)},rotate:function(t,e){return n.rotate(t,e)}}}),i("e",["t"],function(t){var n=function(t,n,r){return void 0===n&&void 0===r?e(t):t.toAdjustedBlob(n,r)},e=function(t){return t.toBlob()};return{blobToImageResult:function(n){return t.fromBlob(n)},fromBlobAndUrlSync:function(n,e){return t.fromBlobAndUrlSync(n,e)},imageToImageResult:function(n){return t.fromImage(n)},imageResultToBlob:n,imageResultToOriginalBlob:e,imageResultToDataURL:function(t){return t.toDataURL()}}}),i("h",["u"],function(t){var n=function(){return t.getOrDie("URL")};return{createObjectURL:function(t){return n().createObjectURL(t)},revokeObjectURL:function(t){n().revokeObjectURL(t)}}}),u("i",clearTimeout),i("j",["7"],function(t){return t("tinymce.util.Delay")}),i("k",["7"],function(t){return t("tinymce.util.Promise")}),i("l",["7"],function(t){return t("tinymce.util.URI")}),i("b",[],function(){return{getToolbarItems:function(t){return t.getParam("imagetools_toolbar","rotateleft rotateright | flipv fliph | crop editimage imageoptions")},getProxyUrl:function(t){return t.getParam("imagetools_proxy")}}}),i("m",[],function(){function t(t){function n(t){return/^[0-9\.]+px$/.test(t)}var e,r;return e=t.style.width,r=t.style.height,e||r?n(e)&&n(r)?{w:parseInt(e,10),h:parseInt(r,10)}:null:(e=t.width,r=t.height,e&&r?{w:parseInt(e,10),h:parseInt(r,10)}:null)}function n(t,n){var e,r;n&&(e=t.style.width,r=t.style.height,(e||r)&&(t.style.width=n.w+"px",t.style.height=n.h+"px",t.removeAttribute("data-mce-style")),e=t.width,r=t.height,(e||r)&&(t.setAttribute("width",n.w),t.setAttribute("height",n.h)))}function e(t){return{w:t.naturalWidth,h:t.naturalHeight}}return{getImageSize:t,setImageSize:n,getNaturalImageSize:e}}),u("1m",String),i("1e",["q","f","g","1m"],function(t,n,e,r){var o,i=void 0===(o=n.prototype.indexOf)?function(t,n){return x(t,n)}:function(t,n){return o.call(t,n)},u=function(n,e){var r=i(n,e);return-1===r?t.none():t.some(r)},a=function(t,n){return i(t,n)>-1},c=function(t,n){return w(t,n).isSome()},l=function(t,n){for(var e=[],r=0;r<t;r++)e.push(n(r));return e},f=function(t,n){for(var e=[],r=0;r<t.length;r+=n){var o=t.slice(r,r+n);e.push(o)}return e},s=function(t,e){for(var r=t.length,o=new n(r),i=0;i<r;i++){var u=t[i];o[i]=e(u,i,t)}return o},d=function(t,n){for(var e=0,r=t.length;e<r;e++){n(t[e],e,t)}},h=function(t,n){for(var e=t.length-1;e>=0;e--){n(t[e],e,t)}},p=function(t,n){for(var e=[],r=[],o=0,i=t.length;o<i;o++){var u=t[o];(n(u,o,t)?e:r).push(u)}return{pass:e,fail:r}},g=function(t,n){for(var e=[],r=0,o=t.length;r<o;r++){var i=t[r];n(i,r,t)&&e.push(i)}return e},m=function(t,n){if(0===t.length)return[];for(var e=n(t[0]),r=[],o=[],i=0,u=t.length;i<u;i++){var a=t[i],c=n(a);c!==e&&(r.push(o),o=[]),e=c,o.push(a)}return 0!==o.length&&r.push(o),r},v=function(t,n,e){return h(t,function(t){e=n(e,t)}),e},b=function(t,n,e){return d(t,function(t){e=n(e,t)}),e},y=function(n,e){for(var r=0,o=n.length;r<o;r++){var i=n[r];if(e(i,r,n))return t.some(i)}return t.none()},w=function(n,e){for(var r=0,o=n.length;r<o;r++){if(e(n[r],r,n))return t.some(r)}return t.none()},x=function(t,n){for(var e=0,r=t.length;e<r;++e)if(t[e]===n)return e;return-1},I=n.prototype.push,R=function(t){for(var r=[],o=0,i=t.length;o<i;++o){if(!n.prototype.isPrototypeOf(t[o]))throw new e("Arr.flatten item "+o+" was not an array, input: "+t);I.apply(r,t[o])}return r},k=function(t,n){var e=s(t,n);return R(e)},T=function(t,n){for(var e=0,r=t.length;e<r;++e){if(!0!==n(t[e],e,t))return!1}return!0},C=function(t,n){return t.length===n.length&&T(t,function(t,e){return t===n[e]})},B=n.prototype.slice;return{map:s,each:d,eachr:h,partition:p,filter:g,groupBy:m,indexOf:u,foldr:v,foldl:b,find:y,findIndex:w,flatten:R,bind:k,forall:T,exists:c,contains:a,equal:C,reverse:function(t){var n=B.call(t,0);return n.reverse(),n},chunk:f,difference:function(t,n){return g(t,function(t){return!a(n,t)})},mapToObject:function(t,n){for(var e={},o=0,i=t.length;o<i;o++){var u=t[o];e[r(u)]=n(u,o)}return e},pure:function(t){return[t]},sort:function(t,n){var e=B.call(t,0);return e.sort(n),e},range:l,head:function(n){return 0===n.length?t.none():t.some(n[0])},last:function(n){return 0===n.length?t.none():t.some(n[n.length-1])}}}),i("1f",["u"],function(t){return function(){return new(t.getOrDie("XMLHttpRequest"))}}),i("w",["18","1f","k","8"],function(t,n,e,r){var o=function(t){return null!==t&&void 0!==t};return{traverse:function(t,n){var e;return e=n.reduce(function(t,n){return o(t)?t[n]:void 0},t),o(e)?e:null},readBlob:function(n){return new e(function(e){var r=new t;r.onload=function(t){var n=t.target;e(n.result)},r.readAsText(n)})},requestUrlAsBlob:function(t,o){return new e(function(e){var i;(i=new n).onreadystatechange=function(){4===i.readyState&&e({status:i.status,blob:this.response})},i.open("GET",t,!0),r.each(o,function(t,n){i.setRequestHeader(n,t)}),i.responseType="blob",i.send()})},parseJson:function(t){var n;try{n=JSON.parse(t)}catch(t){}return n}}}),i("v",["1e","a","k","w"],function(t,n,e,r){var o=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],i=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],u=function(t){return 400===t||403===t||500===t},a=function(e){return"ImageProxy HTTP error: "+t.find(o,function(t){return e===t.code}).fold(n.constant("Unknown ImageProxy error"),function(t){return t.message})},c=function(t){var n=a(t);return e.reject(n)},l=function(e){return t.find(i,function(t){return t.type===e}).fold(n.constant("Unknown service error"),function(t){return t.message})},f=function(t){var n=r.parseJson(t),e=r.traverse(n,["error","type"]);return"ImageProxy Service error: "+(e?l(e):"Invalid JSON in service error message")},s=function(t,n){return r.readBlob(n).then(function(t){var n=f(t);return e.reject(n)})};return{handleServiceErrorResponse:function(t,n){return u(t)?s(t,n):c(t)},handleHttpError:c,getHttpErrorMsg:a,getServiceErrorMsg:l}}),i("n",["k","8","v","w"],function(t,n,e,r){function o(n){return r.requestUrlAsBlob(n,{}).then(function(n){return n.status<200||n.status>=300?e.handleHttpError(n.status):t.resolve(n.blob)})}var i=function(t,n){var e=-1===t.indexOf("?")?"?":"&";return/[?&]apiKey=/.test(t)||!n?t:t+e+"apiKey="+encodeURIComponent(n)},u=function(n,o){return r.requestUrlAsBlob(i(n,o),{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":o}).then(function(n){return n.status<200||n.status>=300?e.handleServiceErrorResponse(n.status,n.blob):t.resolve(n.blob)})};return{getUrl:function(t,n){return n?u(t,n):o(t)}}}),u("y",setTimeout),i("z",["7"],function(t){return t("tinymce.dom.DOMUtils")}),i("10",["7"],function(t){return t("tinymce.ui.Factory")}),i("11",[],function(){return function(){function t(t){var n;return n=i.splice(++u),i.push(t),{state:t,removed:n}}function n(){if(r())return i[--u]}function e(){if(o())return i[++u]}function r(){return u>0}function o(){return-1!==u&&u<i.length-1}var i=[],u=-1;return{data:i,add:t,undo:n,redo:e,canUndo:r,canRedo:o}}}),u("1g",document),u("1h",Image),i("1i",["7"],function(t){return t("tinymce.geom.Rect")}),i("1j",["k"],function(t){return{loadImage:function(n){return new t(function(t){var e=function(){n.removeEventListener("load",e),t(n)};n.complete?t(n):n.addEventListener("load",e)})}}}),i("1n",["7"],function(t){return t("tinymce.dom.DomQuery")}),i("1o",["7"],function(t){return t("tinymce.util.Observable")}),i("1p",["7"],function(t){return t("tinymce.util.VK")}),i("1k",["1n","1i","10","1o","8","1p"],function(t,n,e,r,o,i){var u=0;return function(a,c,l,f,s){function d(t,n){return{x:n.x+t.x,y:n.y+t.y,w:n.w,h:n.h}}function h(t,n){return{x:n.x-t.x,y:n.y-t.y,w:n.w,h:n.h}}function p(){return h(l,a)}function g(t,e,r,o){var i,u,c,f,s;i=e.x,u=e.y,c=e.w,f=e.h,i+=r*t.deltaX,u+=o*t.deltaY,c+=r*t.deltaW,f+=o*t.deltaH,c<20&&(c=20),f<20&&(f=20),s=a=n.clamp({x:i,y:u,w:c,h:f},l,"move"===t.name),s=h(l,s),k.fire("updateRect",{rect:s}),x(s)}function m(){function n(t){var n;return new(e.get("DragHelper"))(j,{document:f.ownerDocument,handle:j+"-"+t.name,start:function(){n=a},drag:function(e){g(t,n,e.deltaX,e.deltaY)}})}t('<div id="'+j+'" class="'+U+'croprect-container" role="grid" aria-dropeffect="execute">').appendTo(f),o.each(B,function(n){t("#"+j,f).append('<div id="'+j+"-"+n+'"class="'+U+'croprect-block" style="display: none" data-mce-bogus="all">')}),o.each(T,function(n){t("#"+j,f).append('<div id="'+j+"-"+n.name+'" class="'+U+"croprect-handle "+U+"croprect-handle-"+n.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+n.label+'" aria-grabbed="false">')}),C=o.map(T,n),b(a),t(f).on("focusin focusout",function(n){t(n.target).attr("aria-grabbed","focus"===n.type)}),t(f).on("keydown",function(t){function n(t,n,r,o,i){t.stopPropagation(),t.preventDefault(),g(e,r,o,i)}var e;switch(o.each(T,function(n){if(t.target.id===j+"-"+n.name)return e=n,!1}),t.keyCode){case i.LEFT:n(t,e,a,-10,0);break;case i.RIGHT:n(t,e,a,10,0);break;case i.UP:n(t,e,a,0,-10);break;case i.DOWN:n(t,e,a,0,10);break;case i.ENTER:case i.SPACEBAR:t.preventDefault(),s()}})}function v(n){var e;e=o.map(T,function(t){return"#"+j+"-"+t.name}).concat(o.map(B,function(t){return"#"+j+"-"+t})).join(","),n?t(e,f).show():t(e,f).hide()}function b(n){function e(n,e){e.h<0&&(e.h=0),e.w<0&&(e.w=0),t("#"+j+"-"+n,f).css({left:e.x,top:e.y,width:e.w,height:e.h})}o.each(T,function(e){t("#"+j+"-"+e.name,f).css({left:n.w*e.xMul+n.x,top:n.h*e.yMul+n.y})}),e("top",{x:c.x,y:c.y,w:c.w,h:n.y-c.y}),e("right",{x:n.x+n.w,y:n.y,w:c.w-n.x-n.w+c.x,h:n.h}),e("bottom",{x:c.x,y:n.y+n.h,w:c.w,h:c.h-n.y-n.h+c.y}),e("left",{x:c.x,y:n.y,w:n.x-c.x,h:n.h}),e("move",n)}function y(t){b(a=t)}function w(t){c=t,b(a)}function x(t){y(d(l,t))}function I(t){l=t,b(a)}function R(){o.each(C,function(t){t.destroy()}),C=[]}var k,T,C,B,U="mce-",j=U+"crid-"+u++;return T=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],B=["top","right","bottom","left"],m(f),k=o.extend({toggleVisibility:v,setClampRect:I,setRect:y,getInnerRect:p,setInnerRect:x,setViewPortRect:w,destroy:R},r)}}),i("12",["1g","1h","1i","10","k","8","1j","1k"],function(t,n,e,r,o,i,u,a){return{create:function(o){return new(r.get("Control").extend({Defaults:{classes:"imagepanel"},selection:function(t){return arguments.length?(this.state.set("rect",t),this):this.state.get("rect")},imageSize:function(){var t=this.state.get("viewRect");return{w:t.w,h:t.h}},toggleCropRect:function(t){this.state.set("cropEnabled",t)},imageSrc:function(r){var o=this,i=new n;i.src=r,u.loadImage(i).then(function(){var n,r,u=o.state.get("viewRect");if((r=o.$el.find("img"))[0])r.replaceWith(i);else{var a=t.createElement("div");a.className="mce-imagepanel-bg",o.getEl().appendChild(a),o.getEl().appendChild(i)}n={x:0,y:0,w:i.naturalWidth,h:i.naturalHeight},o.state.set("viewRect",n),o.state.set("rect",e.inflate(n,-20,-20)),u&&u.w===n.w&&u.h===n.h||o.zoomFit(),o.repaintImage(),o.fire("load")})},zoom:function(t){return arguments.length?(this.state.set("zoom",t),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var t,n,e,r,o,i,u,a=this;u=10,t=a.$el.find("img"),n=a.getEl().clientWidth,e=a.getEl().clientHeight,r=t[0].naturalWidth,o=t[0].naturalHeight,(i=Math.min((n-u)/r,(e-u)/o))>=1&&(i=1),a.zoom(i)},repaintImage:function(){var t,n,e,r,o,i,u,a,c,l,f;f=this.getEl(),c=this.zoom(),l=this.state.get("rect"),u=this.$el.find("img"),a=this.$el.find(".mce-imagepanel-bg"),o=f.offsetWidth,i=f.offsetHeight,e=u[0].naturalWidth*c,r=u[0].naturalHeight*c,t=Math.max(0,o/2-e/2),n=Math.max(0,i/2-r/2),u.css({left:t,top:n,width:e,height:r}),a.css({left:t,top:n,width:e,height:r}),this.cropRect&&(this.cropRect.setRect({x:l.x*c+t,y:l.y*c+n,w:l.w*c,h:l.h*c}),this.cropRect.setClampRect({x:t,y:n,w:e,h:r}),this.cropRect.setViewPortRect({x:0,y:0,w:o,h:i}))},bindStates:function(){function t(t){n.cropRect=new a(t,n.state.get("viewRect"),n.state.get("viewRect"),n.getEl(),function(){n.fire("crop")}),n.cropRect.on("updateRect",function(t){var e=t.rect,r=n.zoom();e={x:Math.round(e.x/r),y:Math.round(e.y/r),w:Math.round(e.w/r),h:Math.round(e.h/r)},n.state.set("rect",e)}),n.on("remove",n.cropRect.destroy)}var n=this;n.state.on("change:cropEnabled",function(t){n.cropRect.toggleVisibility(t.value),n.repaintImage()}),n.state.on("change:zoom",function(){n.repaintImage()}),n.state.on("change:rect",function(e){var r=e.value;n.cropRect||t(r),n.cropRect.setRect(r)})}}))(o)}}}),i("o",["d","e","h","x","y","z","10","k","8","11","12"],function(t,n,e,r,o,i,u,a,c,l,f){function s(t){return{blob:t,url:e.createObjectURL(t)}}function d(t){t&&e.revokeObjectURL(t.url)}function h(t){c.each(t,d)}function p(e,a,p,g){function m(t){var n,e,o,i;n=F.find("#w")[0],e=F.find("#h")[0],o=parseInt(n.value(),10),i=parseInt(e.value(),10),F.find("#constrain")[0].checked()&&lt&&ft&&o&&i&&("w"===t.control.settings.name?(i=r.round(o*st),e.value(i)):(o=r.round(i*dt),n.value(o))),lt=o,ft=i}function v(t){return r.round(100*t)+"%"}function b(){F.find("#undo").disabled(!ht.canUndo()),F.find("#redo").disabled(!ht.canRedo()),F.statusbar.find("#save").disabled(!ht.canUndo())}function y(){F.find("#undo").disabled(!0),F.find("#redo").disabled(!0)}function w(t){t&&X.imageSrc(t.url)}function x(t){return function(){var n=c.grep(ct,function(n){return n.settings.name!==t});c.each(n,function(t){t.hide()}),t.show(),t.focus()}}function I(t){w(W=s(t))}function R(t){w(a=s(t)),h(ht.add(a).removed),b()}function k(){var e=X.selection();n.blobToImageResult(a.blob).then(function(n){t.crop(n,e.x,e.y,e.w,e.h).then(pt).then(function(t){R(t),B()})})}function T(t){var e=[].slice.call(arguments,1);return function(){var r=W||a;n.blobToImageResult(r.blob).then(function(n){t.apply(this,[n].concat(e)).then(pt).then(I)})}}function C(t){var e=[].slice.call(arguments,1);return function(){n.blobToImageResult(a.blob).then(function(n){t.apply(this,[n].concat(e)).then(pt).then(R)})}}function B(){w(a),d(W),x(P)(),b()}function U(t,n){W?n():o(function(){t-- >0?U(t,n):e.windowManager.alert("Error: failed to apply image operation.")},10)}function j(){W?(R(W.blob),B()):U(100,j)}function z(){var t=X.zoom();t<2&&(t+=.1),X.zoom(t)}function E(){var t=X.zoom();t>.1&&(t-=.1),X.zoom(t)}function S(){w(a=ht.undo()),b()}function M(){w(a=ht.redo()),b()}function O(){p(a.blob),F.close()}function D(t){return u.create("Form",{layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:t})}function A(t,e){return D([{text:"Back",onclick:B},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:j}]).hide().on("show",function(){y(),n.blobToImageResult(a.blob).then(function(t){return e(t)}).then(pt).then(function(t){var n=s(t);w(n),d(W),W=n})})}function H(t,e,r,o,i){function u(t){n.blobToImageResult(a.blob).then(function(n){return e(n,t)}).then(pt).then(function(t){var n=s(t);w(n),d(W),W=n})}return D([{text:"Back",onclick:B},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(t){u(t.value)},minValue:o,
maxValue:i,value:r,previewFilter:v},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:j}]).hide().on("show",function(){this.find("slider").value(r),y()})}function L(t,e){function r(){var t,r,o;t=F.find("#r")[0].value(),r=F.find("#g")[0].value(),o=F.find("#b")[0].value(),n.blobToImageResult(a.blob).then(function(n){return e(n,t,r,o)}).then(pt).then(function(t){var n=s(t);w(n),d(W),W=n})}return D([{text:"Back",onclick:B},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:r,previewFilter:v},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:r,previewFilter:v},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:r,previewFilter:v},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:j}]).hide().on("show",function(){F.find("#r,#g,#b").value(1),y()})}function _(t){!0===t.control.value()&&(st=ft/lt,dt=lt/ft)}var F,P,q,W,V,N,G,X,$,Y,J,K,Z,Q,tt,nt,et,rt,ot,it,ut,at,ct,lt,ft,st,dt,ht=new l,pt=function(t){return t.toBlob()};V=D([{text:"Back",onclick:B},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:k}]).hide().on("show hide",function(t){X.toggleCropRect("show"===t.type)}).on("show",y),N=D([{text:"Back",onclick:B},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:m},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:m},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:_},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(n){var e=parseInt(F.find("#w").value(),10),r=parseInt(F.find("#h").value(),10);n.preventDefault(),C(t.resize,e,r)(),B()}).on("show",y),G=D([{text:"Back",onclick:B},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:T(t.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:T(t.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:T(t.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:T(t.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:j}]).hide().on("show",y),J=A("Invert",t.invert),ot=A("Sharpen",t.sharpen),it=A("Emboss",t.emboss),K=H("Brightness",t.brightness,0,-1,1),Z=H("Hue",t.hue,180,0,360),Q=H("Saturate",t.saturate,0,-1,1),tt=H("Contrast",t.contrast,0,-1,1),nt=H("Grayscale",t.grayscale,0,0,1),et=H("Sepia",t.sepia,0,0,1),rt=L("Colorize",t.colorize),ut=H("Gamma",t.gamma,0,-1,1),at=H("Exposure",t.exposure,1,0,2),q=D([{text:"Back",onclick:B},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:x(Z)},{text:"saturate",icon:"saturate",onclick:x(Q)},{text:"sepia",icon:"sepia",onclick:x(et)},{text:"emboss",icon:"emboss",onclick:x(it)},{text:"exposure",icon:"exposure",onclick:x(at)},{type:"spacer",flex:1}]).hide(),P=D([{tooltip:"Crop",icon:"crop",onclick:x(V)},{tooltip:"Resize",icon:"resize2",onclick:x(N)},{tooltip:"Orientation",icon:"orientation",onclick:x(G)},{tooltip:"Brightness",icon:"sun",onclick:x(K)},{tooltip:"Sharpen",icon:"sharpen",onclick:x(ot)},{tooltip:"Contrast",icon:"contrast",onclick:x(tt)},{tooltip:"Color levels",icon:"drop",onclick:x(rt)},{tooltip:"Gamma",icon:"gamma",onclick:x(ut)},{tooltip:"Invert",icon:"invert",onclick:x(J)}]),X=f.create({flex:1,imageSrc:a.url}),$=u.create("Container",{layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:S},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:M},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:z},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:E}]}),Y=u.create("Container",{type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[$,X]}),ct=[P,V,N,G,q,J,K,Z,Q,tt,nt,et,rt,ot,it,ut,at],(F=e.windowManager.open({layout:"flex",direction:"column",align:"stretch",minWidth:r.min(i.DOM.getViewPort().w,800),minHeight:r.min(i.DOM.getViewPort().h,650),title:"Edit image",items:ct.concat([Y]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:O},{text:"Cancel",onclick:"close"}]})).on("close",function(){g(),h(ht.data),ht=null,W=null}),ht.add(a),b(),X.on("load",function(){lt=X.imageSize().w,ft=X.imageSize().h,st=ft/lt,dt=lt/ft,F.find("#w").value(lt),F.find("#h").value(ft)}),X.on("crop",k)}function g(t,n){return new a(function(e,r){return n.toBlob().then(function(n){p(t,s(n),e,r)})})}return{edit:g}}),i("9",["c","d","e","a","h","i","j","k","8","l","b","m","n","o"],function(t,n,e,r,o,i,u,a,c,l,f,s,d,h){var p=0,g=function(t,n){return t.dom.is(n,"img:not([data-mce-object],[data-mce-placeholder])")&&(w(t,n)||x(t,n)||t.settings.imagetools_proxy)},m=function(t,n){t.notificationManager.open({text:n,type:"error"})},v=function(t){return t.selection.getNode()},b=function(t,n){var e=n.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return e?t.dom.encode(e[1]):null},y=function(){return"imagetools"+p++},w=function(t,n){var e=n.src;return 0===e.indexOf("data:")||0===e.indexOf("blob:")||new l(e).host===t.documentBaseURI.host},x=function(t,n){return-1!==c.inArray(t.settings.imagetools_cors_hosts,new l(n.src).host)},I=function(t){return t.settings.api_key||t.settings.imagetools_api_key},R=function(n,e){var r,o=e.src;return x(n,e)?d.getUrl(e.src,null):w(n,e)?t.imageToBlob(e):(o=f.getProxyUrl(n),o+=(-1===o.indexOf("?")?"?":"&")+"url="+encodeURIComponent(e.src),r=I(n),d.getUrl(o,r))},k=function(t){var n;return(n=t.editorUpload.blobCache.getByUri(v(t).src))?a.resolve(n.blob()):R(t,v(t))},T=function(t,n){var e=u.setEditorTimeout(t,function(){t.editorUpload.uploadImagesAuto()},t.settings.images_upload_timeout||3e4);n.set(e)},C=function(t){i(t.get())},B=function(t,n,e,r){return n.toBlob().then(function(o){var i,u,a,c,l;return a=t.editorUpload.blobCache,i=(l=v(t)).src,t.settings.images_reuse_filename&&((c=a.getByUri(i))?(i=c.uri(),u=c.name()):u=b(t,i)),c=a.create({id:y(),blob:o,base64:n.toBase64(),uri:i,name:u}),a.add(c),t.undoManager.transact(function(){function n(){t.$(l).off("load",n),t.nodeChanged(),e?t.editorUpload.uploadImagesAuto():(C(r),T(t,r))}t.$(l).on("load",n),t.$(l).attr({src:c.blobUri()}).removeAttr("data-mce-src")}),c})},U=function(t,n,o){return function(){return t._scanForImages().then(r.curry(k,t)).then(e.blobToImageResult).then(o).then(function(e){return B(t,e,!1,n)},function(n){m(t,n)})}};return{rotate:function(t,e,r){return function(){return U(t,e,function(e){var o=s.getImageSize(v(t));return o&&s.setImageSize(v(t),{w:o.h,h:o.w}),n.rotate(e,r)})()}},flip:function(t,e,r){return function(){return U(t,e,function(t){return n.flip(t,r)})()}},editImageDialog:function(n,i){return function(){var u=v(n),c=s.getNaturalImageSize(u),l=function(n){return new a(function(e){t.blobToImage(n).then(function(t){var r=s.getNaturalImageSize(t);c.w===r.w&&c.h===r.h||s.getImageSize(u)&&s.setImageSize(u,r),o.revokeObjectURL(t.src),e(n)})})},f=function(t,n){return h.edit(t,n).then(l).then(e.blobToImageResult).then(function(n){return B(t,n,!0,i)},function(){})};k(n).then(e.blobToImageResult).then(r.curry(f,n),function(t){m(n,t)})}},isEditableImage:g,cancelTimedUpload:C}}),i("3",["8","9"],function(t,n){return{register:function(e,r){t.each({mceImageRotateLeft:n.rotate(e,r,-90),mceImageRotateRight:n.rotate(e,r,90),mceImageFlipVertical:n.flip(e,r,"v"),mceImageFlipHorizontal:n.flip(e,r,"h"),mceEditImage:n.editImageDialog(e,r)},function(t,n){e.addCommand(n,t)})}}}),i("4",["9"],function(t){return{setup:function(n,e,r){n.on("NodeChange",function(o){var i=r.get();i&&i.src!==o.element.src&&(t.cancelTimedUpload(e),n.editorUpload.uploadImagesAuto(),r.set(null)),t.isEditableImage(n,o.element)&&r.set(o.element)})}}}),i("5",[],function(){return{register:function(t){t.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"}),t.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"}),t.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"}),t.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"}),t.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"}),t.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}}}),i("6",["a","b","9"],function(t,n,e){return{register:function(r){r.addContextToolbar(t.curry(e.isEditableImage,r),n.getToolbarItems(r))}}}),i("0",["1","2","3","4","5","6"],function(t,n,e,r,o,i){return n.add("imagetools",function(n){var u=t(0),a=t(null);e.register(n,u),o.register(n),i.register(n),r.setup(n,u,a)}),function(){}}),r("0")()}();