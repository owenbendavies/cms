!function(){var t={},e=function(e){for(var n=t[e],r=n.deps,i=n.defn,c=r.length,a=new Array(c),u=0;u<c;++u)a[u]=o(r[u]);var l=i.apply(null,a);if(void 0===l)throw"module ["+e+"] returned undefined";n.instance=l},n=function(e,n,o){if("string"!=typeof e)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+e;if(void 0===o)throw"no definition function for "+e;t[e]={deps:n,defn:o,instance:void 0}},o=function(n){var o=t[n];if(void 0===o)throw"module ["+n+"] was undefined";return void 0===o.instance&&e(n),o.instance},r=function(t,e){for(var n=t.length,r=new Array(n),i=0;i<n;++i)r[i]=o(t[i]);e.apply(null,r)};({}).bolt={module:{api:{define:n,require:r,demand:o}}};var i=n;(function(t,e){i(t,[],function(){return e})})("6",tinymce.util.Tools.resolve),i("1",["6"],function(t){return t("tinymce.PluginManager")}),i("8",["6"],function(t){return t("tinymce.dom.DOMUtils")}),i("9",["6"],function(t){return t("tinymce.util.I18n")}),i("a",["6"],function(t){return t("tinymce.util.Tools")}),i("3",[],function(){return{getTocClass:function(t){return t.getParam("toc_class","mce-toc")},getTocHeader:function(t){var e=t.getParam("toc_header","h2");return/^h[1-6]$/.test(e)?e:"h2"},getTocDepth:function(t){var e=parseInt(t.getParam("toc_depth","3"),10);return e>=1&&e<=9?e:3}}}),i("b",[],function(){return{create:function(t){var e=0;return function(){var n=(new Date).getTime().toString(32);return t+n+(e++).toString(32)}}}}),i("7",["8","9","a","3","b"],function(t,e,n,o,r){var i=r.create("mcetoc_"),c=function(t){var e,n=[];for(e=1;e<=t;e++)n.push("h"+e);return n.join(",")},a=function(t){return u(t).length>0},u=function(t){var e=o.getTocClass(t),r=o.getTocHeader(t),a=c(o.getTocDepth(t)),u=t.$(a);return u.length&&/^h[1-9]$/i.test(r)&&(u=u.filter(function(n,o){return!t.dom.hasClass(o.parentNode,e)})),n.map(u,function(e){return{id:e.id?e.id:i(),level:parseInt(e.nodeName.replace(/^H/i,""),10),title:t.$.text(e),element:e}})},l=function(t){var e,n=9;for(e=0;e<t.length;e++)if(t[e].level<n&&(n=t[e].level),1===n)return n;return n},d=function(e,n){var o="</"+e+">";return"<"+e+' contenteditable="true">'+t.DOM.encode(n)+o},f=function(t){var e=s(t);return'<div class="'+t.dom.encode(o.getTocClass(t))+'" contenteditable="false">'+e+"</div>"},s=function(t){var n,r,i,c,a="",f=u(t),s=l(f)-1;if(!f.length)return"";for(a+=d(o.getTocHeader(t),e.translate("Table of Contents")),n=0;n<f.length;n++){if((i=f[n]).element.id=i.id,c=f[n+1]&&f[n+1].level,s===i.level)a+="<li>";else for(r=s;r<i.level;r++)a+="<ul><li>";if(a+='<a href="#'+i.id+'">'+i.title+"</a>",c!==i.level&&c)for(r=i.level;r>c;r--)a+="</li></ul><li>";else a+="</li>",c||(a+="</ul>");s=i.level}return a},v=function(t,e){return!e.length||t.dom.getParents(e[0],".mce-offscreen-selection").length>0},m=function(t){var e=o.getTocClass(t),n=t.$("."+e);v(t,n)?t.insertContent(f(t)):g(t)},g=function(t){var e=o.getTocClass(t),n=t.$("."+e);n.length&&t.undoManager.transact(function(){n.html(s(t))})};return{hasHeaders:a,insertToc:m,updateToc:g}}),i("2",["7"],function(t){return{register:function(e){e.addCommand("mceInsertToc",function(){t.insertToc(e)}),e.addCommand("mceUpdateToc",function(){t.updateToc(e)})}}}),i("4",["3"],function(t){return{setup:function(e){var n=e.$,o=t.getTocClass(e);e.on("PreProcess",function(t){var e=n("."+o,t.node);e.length&&(e.removeAttr("contentEditable"),e.find("[contenteditable]").removeAttr("contentEditable"))}),e.on("SetContent",function(){var t=n("."+o);t.length&&(t.attr("contentEditable",!1),t.children(":first-child").attr("contentEditable",!0))})}}}),i("5",["3","7"],function(t,e){var n=function(t){return function(n){var o=n.control;t.on("LoadContent SetContent change",function(){o.disabled(t.readonly||!e.hasHeaders(t))})}},o=function(e){return function(n){return n&&e.dom.is(n,"."+t.getTocClass(e))&&e.getBody().contains(n)}};return{register:function(t){t.addButton("toc",{tooltip:"Table of Contents",cmd:"mceInsertToc",icon:"toc",onPostRender:n(t)}),t.addButton("tocupdate",{tooltip:"Update",cmd:"mceUpdateToc",icon:"reload"}),t.addMenuItem("toc",{text:"Table of Contents",context:"insert",cmd:"mceInsertToc",onPostRender:n(t)}),t.addContextToolbar(o(t),"tocupdate")}}}),i("0",["1","2","3","4","5"],function(t,e,n,o,r){return t.add("toc",function(t){e.register(t),r.register(t),o.setup(t)}),function(){}}),o("0")()}();